(function(window,document,undefined){"use strict";function throttle(func,wait){var timeout;return function(){function throttler(){timeout=undefined;func.call(this)}if(!timeout){timeout=window.setTimeout(throttler,wait)}}}function getStyle(elem,prop){if(window.getComputedStyle){return window.getComputedStyle(elem).getPropertyValue(prop)}else if(elem.currentStyle){return elem.currentStyle[prop]}}var queue=[];function sonar(elem,callback,options){if(typeof callback==="object"){options=callback}else if(typeof callback==="function"){if(options){options.scrollin=callback}else{options={scrollin:callback}}}var parent=options.parent;if(!parent){var parentNode=elem;var overflow;while((parentNode=parentNode.parentNode)&&parentNode.nodeType===1){overflow=getStyle(parentNode,"overflow");if(overflow==="auto"||overflow==="scroll"){parent=parentNode;break}}parent=parent||document.documentElement}options.parent=parent;if(options.scrollin||options.scrollout){options.elem=elem;queue.push(options);poll();var delay=options.delay||0;if(!parent.__Sonar){if(parent.addEventListener){parent.addEventListener("scroll",throttle(poll,delay),false);parent.addEventListener("resize",throttle(poll,delay),false)}else if(window.attachEvent){parent.attachEvent("onscroll",throttle(poll,delay));parent.attachEvent("onresize",throttle(poll,delay))}parent.__Sonar=true}}return detect(elem,options.distance,options.visibility,options.parent)}var body;function detect(elem,distance,visibility,parent){if(!body){body=document.body}if(!visibility){visibility=0}if(distance===undefined){distance=0}var parentElem=elem;var elemTop=0;var bodyHeight=body.offsetHeight;var screenHeight=parent.clientHeight||0;var scrollTop=parent.scrollTop||0;var elemHeight=elem.offsetHeight||0;if(!elem.sonarElemTop||elem.sonarBodyHeight!==bodyHeight){if(parentElem.offsetParent){do{elemTop+=parentElem.offsetTop}while(parentElem=parentElem.offsetParent)}elem.sonarElemTop=elemTop;elem.sonarBodyHeight=bodyHeight}return!(elem.sonarElemTop+(visibility?0:elemHeight*visibility)<scrollTop-distance)&&!(elem.sonarElemTop+(visibility?elemHeight*visibility:0)>scrollTop+screenHeight+distance)}function poll(){var index,item,detected;for(index in queue){if(queue.hasOwnProperty(index)){item=queue[index];if(item.scrollin||item.scrollout){detected=detect(item.elem,item.distance,item.visibility,item.parent);if(detected!==item.detected){if(detected){if(item.scrollin){item.scrollin.call(item,item.elem)}}else{if(item.scrollout){item.scrollout.call(item,item.elem)}}item.detected=detected}}}}}sonar.poll=poll;window.Sonar=sonar})(this,document);