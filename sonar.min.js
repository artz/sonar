(function(window,document,undefined){"use strict";function throttle(func,wait){var timeout;return function(){function throttler(){timeout=undefined;func.call(this)}if(!timeout){timeout=window.setTimeout(throttler,wait)}}}var queue=[];var bound;function sonar(elem,callback,options){if(typeof callback==="object"){options=callback}else if(typeof callback==="function"){if(options){options.scrollin=callback}else{options={scrollin:callback}}}var delay=options.delay||0;if(!bound){if(window.addEventListener){window.addEventListener("scroll",throttle(poll,delay),false);window.addEventListener("resize",throttle(poll,delay),false)}else if(window.attachEvent){window.attachEvent("onscroll",throttle(poll,delay));window.attachEvent("onresize",throttle(poll,delay))}bound=true}if(options.scrollin||options.scrollout){options.elem=elem;queue.push(options);poll()}return detect(elem,options.distance,options.visibility)}var body;function detect(elem,distance,visibility){if(!body){body=document.body}if(!visibility){visibility=0}if(distance===undefined){distance=0}var parentElem=elem,elemTop=0,bodyHeight=body.offsetHeight,screenHeight=window.innerHeight||document.documentElement.clientHeight||body.clientHeight||0,scrollTop=document.documentElement.scrollTop||window.pageYOffset||body.scrollTop||0,elemHeight=elem.offsetHeight||0;if(!elem.sonarElemTop||elem.sonarBodyHeight!==bodyHeight){if(parentElem.offsetParent){do{elemTop+=parentElem.offsetTop}while(parentElem=parentElem.offsetParent)}elem.sonarElemTop=elemTop;elem.sonarBodyHeight=bodyHeight}return!(elem.sonarElemTop+(visibility?0:elemHeight*visibility)<scrollTop-distance)&&!(elem.sonarElemTop+(visibility?elemHeight*visibility:0)>scrollTop+screenHeight+distance)}function poll(){var index,item,detected;for(index in queue){if(queue.hasOwnProperty(index)){item=queue[index];if(item.scrollin||item.scrollout){detected=detect(item.elem,item.distance,item.visibility);if(detected!==item.detected){if(detected){if(item.scrollin){item.scrollin.call(item,item.elem)}}else{if(item.scrollout){item.scrollout.call(item,item.elem)}}item.detected=detected}}}}}window.Sonar=sonar})(this,document);